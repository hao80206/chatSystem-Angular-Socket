<app-navbar></app-navbar>

<h3>You're in Group: {{ groupId }} -- Channel: {{ channelService.getChannelById(channelId)?.name }}</h3>

<div class="chat-container">
    <!-- Online Users Row -->
    <div class="chat-users-panel">
      <h6>Users in this Group (online â†’ ðŸŸ¢   offline â†’ ðŸ”´)</h6>
      <button class="leave-channel-button" (click)="leaveChannel()">Back to Channel List</button>
      <div class="users-row">
        <div *ngFor="let user of allUsersInGroup" class="user">
          <div class="avatar">
            <img [src]="user.profileImg || '/assets/Icons/woman-img-1.png'" alt="{{user.username}}">
            <div class="status"
                 [ngClass]="{
                   'online': user.status==='online',
                   'offline': user.status==='offline',
                 }"></div>
          </div>
          <div class="name">{{ user.username }}</div>
        </div>
      </div>
    </div>
  
    <!-- Chat Messages Field -->
    <div class="message-field">
      <div *ngFor="let msg of messages" 
          class="message" 
          [ngClass]="{
            'my-message': msg.senderId === currentUser?.id,
            'other-message': msg.senderId !== currentUser?.id
          }">

        <!-- Avatar + Name -->
        <div class="avatar-block">
          <img class="msg-icon" [src]="msg.profileImg || '/assets/Icons/woman-img-1.png'" alt="{{ msg.user }}">
          <div class="msg-user">{{ msg.user }}</div>
        </div>

        <!-- Message Bubble -->
        <div class="msg-bubble">

          <!-- Text Message -->
          <div *ngIf="msg.type === 'text'" class="msg-text">
            {{ msg.text || msg.content }}
          </div>

          <!-- Image Message -->
          <div *ngIf="msg.type === 'image'" class="msg-image">
            <img [src]="msg.content" alt="sent image" class="sent-image" />
          </div>

          <div class="msg-time">
            {{ msg.timestamp | date:'shortTime' }}
          </div>
        </div>

      </div>
    </div>
  
    <!-- Send Message Form -->
    <div class="send-message-form">
      <input type="text" placeholder="Type a message..." [(ngModel)]="newMessage" (keyup.enter)="sendMessage()">
      <input type="file" (change)="onImageSelected($event)" accept="image/*" #fileInput hidden />
      <button (click)="sendMessage()">Send</button>
      <button (click)="fileInput.click()">ðŸ“·</button> <!-- Image button -->
    </div>

      <!-- Admin: Ban User Section -->
      <div class="admin-actions" *ngIf="userService.isGroupAdmin(currentUser!)">
        <h3>IMPORTANT: User Control Panel</h3>
        <h4>Group Admin can ban chat users and report to Super Admin</h4>
        <div *ngFor="let user of usersInGroup">
          <span>{{ user.username }}</span>
          <button class="ban-btn" *ngIf="canBan(user)" (click)="banUser(user.id)">Ban</button>
        </div>
      </div>

</div>


